{include="header"}

{if="$fsc->agente"}
<script type="text/javascript" src="{$fsc->get_js_location('provincias.js')}"></script>
<script type="text/javascript">
    function llenar_organizacion(obj,padre,destino){
        if(padre !== undefined){
            var data = "";
            var iddestino = '#'+destino;
            $.ajax({
                type: 'GET',
                url : '{$fsc->url()}&type=organizacion',
                data : padre+'='+obj.value,
                async: false,
                success : function(response) {
                    if(response.length !== 0){
                        data = response;
                    }else{
                        alert('¡No hay Rutas en este Almacén!');
                    }
                },
                error: function(response) {
                    alert(response);
                }
            });
            var select = $(iddestino);
            select.empty();
            if(data.length !== 0){
                select.append(
                    $('<option></option>').val('').html('--------------')
                );
                $.each(data, function() {
                    select.append('<option value=' + this['codorganizacion'] + '>' + this['descripcion'] + '</option>');
                });
            }
        }
    }
    $(document).ready(function () {
        $("#b_delete_agente").click(function (event) {
            event.preventDefault();
            if( confirm("¿Realmente desea eliminar el agente?") )
            {
                window.location.href = '{$fsc->ppage->url()}&delete={$fsc->agente->codagente}';
            }
        });
   });
</script>

<div class="container-fluid">
   <div class="row" style="margin-bottom: 10px;">
      <div class="col-sm-3 col-xs-3">
         <div class="btn-group">
            <a class="btn btn-sm btn-default" href="index.php?page=admin_agentes">
               <span class="glyphicon glyphicon-arrow-left"></span>
               <span class="hidden-xs hidden-sm">&nbsp; Empleados</span>
            </a>
            <a class="btn btn-sm btn-default" href="{$fsc->url()}" title="Recargar la página">
               <span class="glyphicon glyphicon-refresh"></span>
            </a>
         </div>
      </div>
      <div class="col-sm-6 col-xs-6 text-center">
         <h2 style="margin-top: 0px;">Editar empleado {$fsc->agente->codagente}</h2>
      </div>
      <div class="col-sm-3 col-xs-3 text-right">
         <a class="btn btn-sm btn-success" href="index.php?page=admin_agentes#nuevo" title="Nuevo empleado">
            <span class="glyphicon glyphicon-plus"></span>
         </a>
         {if="$fsc->allow_delete"}
         <a href="#" id="b_delete_agente" class="btn btn-sm btn-danger">
            <span class="glyphicon glyphicon-trash"></span>
            <span class="hidden-xs hidden-sm">&nbsp; Eliminar</span>
         </a>
         {/if}
      </div>
   </div>
   <div class="row">
      <div class="col-lg-2 col-md-3 col-sm-3">
         <div class="list-group">
            <a id="b_generales" href="{$fsc->url()}" class="list-group-item active">
               <span class="glyphicon glyphicon-dashboard"></span> &nbsp; Datos generales
            </a>
            {loop="$fsc->extensions"}
               {if="$value->type=='button'"}
               <a id="b_{$value->from}" href="index.php?page={$value->from}{$value->params}&codagente={$fsc->agente->codagente}" class="list-group-item">
                  {$value->text}
               </a>
               {/if}
            {/loop}
         </div>
         <!-- Panel para nomina !-->
         <div class="list-group">
            <a id="b_nomina" href="{$fsc->url()}" class="list-group-item active">
               <span class="glyphicon glyphicon-file"></span> &nbsp; Datos nómina
            </a>
            <a id="b_movimientos" href="{$fsc->url()}" class="list-group-item">
               <span class="fa fa-code-fork"></span> &nbsp; Movimientos
            </a>
            <a id="b_movimientos" href="{$fsc->url()}" class="list-group-item">
                <span class="fa fa-archive"></span> &nbsp; Contratos
            </a>
            <a id="b_sueldo" href="{$fsc->url()}" class="list-group-item">
               <span class="fa fa-money"></span> &nbsp; Pago e Incentivos
            </a>
            <a id="b_dependientes" href="{$fsc->url()}" class="list-group-item">
               <span class="fa fa-group"></span> &nbsp; Carga Familiar
            </a>
            <a id="b_movimientos" href="{$fsc->url()}" class="list-group-item">
               <span class="fa fa-calendar-minus-o"></span> &nbsp; Ausencias
            </a>
            <a id="b_asistencia" href="{$fsc->url()}" class="list-group-item">
               <span class="fa fa-clock-o"></span> &nbsp; Control de Horas
            </a>
            <a id="b_resumen" href="{$fsc->url()}" class="list-group-item">
               <span class="fa fa-suitcase"></span> &nbsp; Hoja de Vida
            </a>

            {loop="$fsc->extensions"}
               {if="$value->type=='button_nomina'"}
               <a id="b_{$value->from}" href="index.php?page={$value->from}{$value->params}&codagente={$fsc->agente->codagente}" class="list-group-item">
                  {$value->text}
               </a>
               {/if}
            {/loop}
         </div>
      </div>
      <div class="col-lg-10 col-md-9 col-sm-9">
         <form class="form" role="form" action="{$fsc->url()}" method="post">
            <div class='panel {if="$fsc->agente->f_baja"}panel-danger{else}panel-primary{/if}' id='panel_generales'>
               <div class="panel-heading">
                  <h3 class="panel-title">
                     {$fsc->agente->get_fullname()}
                     {if="$fsc->agente->f_baja"}
                     &nbsp; <span class="label label-default" title="El empleado ha sido dado de baja">Baja</span>
                     {/if}
                  </h3>
               </div>
               <div class="panel-body">
                  <div class="col-sm-3">
                     <div class="form-group">
                        Nombre:
                        <input class="form-control input-sm" type="text" name="nombre" value="{$fsc->agente->nombre}" autocomplete="off"/>
                     </div>
                  </div>
                  <div class="col-sm-3">
                     <div class="form-group">
                        Primer Apellido:
                        <input class="form-control input-sm" type="text" name="apellidos" value="{$fsc->agente->apellidos}" autocomplete="off"/>
                     </div>
                  </div>
                  <div class="col-sm-3">
                     <div class="form-group">
                        Segundo Apellido:
                        <input class="form-control input-sm" type="text" name="segundo_apellido" value="{$fsc->agente->segundo_apellido}" autocomplete="off"/>
                     </div>
                  </div>
                  <div class="col-sm-3">
                     <div class="form-group">
                        {#FS_CIFNIF#}:
                        <input class="form-control input-sm" type="text" name="dnicif" value="{$fsc->agente->dnicif}" autocomplete="off"/>
                     </div>
                  </div>
                  <div class="col-sm-2">
                     <div class="form-group">
                        Sexo:<br/>
                        <label><input class="radio-inline radio-control" type="radio" name="sexo" value="M"/> Masculino</label>
                        <label><input class="radio-inline radio-control" type="radio" name="sexo" value="F"/> Femenino</label>
                     </div>
                  </div>
                  <div class="col-sm-3">
                     <div class="form-group">
                        Teléfono:
                        <input class="form-control input-sm" type="text" name="telefono" value="{$fsc->agente->telefono}" autocomplete="off"/>
                     </div>
                  </div>
                  <div class="col-sm-4">
                     <div class="form-group">
                        Email:
                        <input class="form-control input-sm" type="text" name="email" value="{$fsc->agente->email}" autocomplete="off"/>
                     </div>
                  </div>
                  <div class="col-sm-3">
                     <div class="form-group">
                        Cargo ocupado:
                        <select name="codcargo" required class="form-control input-sm">
                            <option value="">--------</option>
                            {loop="$fsc->cargos->all()"}
                            <option value="{$value->codcargo}" {if="$fsc->agente->codcargo==$value->codcargo"}selected{/if}>{$value->descripcion}</option>
                            {/loop}
                        </select>
                        <span class="help-block">Cambios aquí deben realizarse en Movimientos</span>
                     </div>
                  </div>
                  <div class="col-sm-3">
                     <div class="form-group">
                        Provincia:
                        <input id="ac_provincia" class="form-control input-sm" type="text" name="provincia" value="{$fsc->agente->provincia}" autocomplete="off"/>
                     </div>
                  </div>
                  <div class="col-sm-3">
                     <div class="form-group">
                        Ciudad:
                        <input class="form-control input-sm" type="text" name="ciudad" value="{$fsc->agente->ciudad}"/>
                     </div>
                  </div>
                  <div class="col-sm-6">
                     <div class="form-group">
                        Dirección:
                        <input class="form-control input-sm" type="text" name="direccion" value="{$fsc->agente->direccion}" autocomplete="off"/>
                     </div>
                  </div>
                  <div class="col-sm-3">
                     <div class="form-group">
                        Almacén:
                        <select name="codalmacen" required class="form-control input-sm">
                            <option value="">--------</option>
                            {loop="$fsc->almacen->all()"}
                            <option value="{$value->codalmacen}" {if="$fsc->agente->codalmacen==$value->codalmacen"}selected{/if}>{$value->nombre}</option>
                            {/loop}
                        </select>
                     </div>
                  </div>
                  <div class="col-sm-3">
                     <div class="form-group">
                        Reporta a:
                        <select name="codsupervisor" required class="form-control input-sm">
                            <option value="">--------</option>
                            {loop="$fsc->agente->all()"}
                            <option value="{$value->codagente}" {if="$fsc->agente->codsupervisor==$value->codagente"}selected{/if}>{$value->nombreap}</option>
                            {/loop}
                        </select>
                     </div>
                  </div>
                  <div class="col-sm-3">
                     <div class="form-group">
                        Categoria de empleado:
                        <select name="codcategoria" required class="form-control input-sm">
                            <option value="">--------</option>
                            {loop="$fsc->categoriaempleado->all()"}
                            <option value="{$value->codcategoria}" {if="$fsc->agente->codcategoria==$value->codcategoria"}selected{/if}>{$value->descripcion}</option>
                            {/loop}
                        </select>
                     </div>
                  </div>
                  <div class="col-sm-3">
                     <div class="form-group">
                        Tipo de Contrato:
                        <select name="codtipo" required class="form-control input-sm">
                            <option value="">--------</option>
                            {loop="$fsc->tipoempleado->all()"}
                            <option value="{$value->codtipo}" {if="$fsc->agente->codtipo==$value->codtipo"}selected{/if}>{$value->descripcion}</option>
                            {/loop}
                        </select>
                     </div>
                  </div>
                  <div class="col-sm-4">
                     <div class="form-group">
                        Gerencia:
                        <select name="codgerencia" id="codgerencia" onchange="llenar_organizacion(this,'codgerencia','codarea')" required class="form-control input-sm">
                            <option value="">--------</option>
                            {loop="$fsc->organizacion->all_tipo('GERENCIA')"}
                            <option value="{$value->codorganizacion}" {if="$fsc->agente->codgerencia==$value->codorganizacion"}selected{/if}>{$value->descripcion}</option>
                            {/loop}
                        </select>
                     </div>
                  </div>
                  <div class="col-sm-4">
                     <div class="form-group">
                        Area:
                        <select name="codarea" id="codarea" onchange="llenar_organizacion(this,'codarea','coddepartamento')" required class="form-control input-sm">
                            <option value="">--------</option>
                            {loop="$fsc->organizacion->all_tipo('AREA')"}
                            <option value="{$value->codorganizacion}" {if="$fsc->agente->codarea==$value->codorganizacion"}selected{/if}>{$value->descripcion}</option>
                            {/loop}
                        </select>
                     </div>
                  </div>
                  <div class="col-sm-4">
                     <div class="form-group">
                        Departamento:
                        <select name="coddepartamento" id="coddepartamento" required class="form-control input-sm">
                            <option value="">--------</option>
                            {loop="$fsc->organizacion->all_tipo('DEPARTAMENTO')"}
                            <option value="{$value->codorganizacion}" {if="$fsc->agente->coddepartamento==$value->codorganizacion"}selected{/if}>{$value->descripcion}</option>
                            {/loop}
                        </select>
                     </div>
                  </div>
                  <div class="col-sm-3">
                     <div class="form-group">
                        Formación:
                        <select name="codformacion" required class="form-control input-sm">
                            <option value="">--------</option>
                            {loop="$fsc->formacion->all()"}
                            <option value="{$value->codformacion}" {if="$fsc->agente->codformacion==$value->codformacion"}selected{/if}>{$value->nombre}</option>
                            {/loop}
                        </select>
                     </div>
                  </div>
                  <div class="col-sm-4">
                     <div class="form-group">
                        Carrera:
                        <input class="form-control input-sm" type="text" name="carrera" value="{$fsc->agente->carrera}" autocomplete="off"/>
                     </div>
                  </div>
                  <div class="col-sm-5">
                     <div class="form-group">
                        Centro de estudios:
                        <input class="form-control input-sm" type="text" name="centroestudios" value="{$fsc->agente->centroestudios}" autocomplete="off"/>
                     </div>
                  </div>
                  <div class="col-sm-4">
                     <div class="form-group">
                        Fecha Nacimiento:
                        <div class="input-group">
                           <span class="input-group-addon">
                              <span class="glyphicon glyphicon-calendar"></span>
                           </span>
                           <input class="form-control datepicker input-sm" type="text" name="f_nacimiento" value="{$fsc->agente->f_nacimiento}" autocomplete="off"/>
                        </div>
                     </div>
                  </div>
                  <div class="col-sm-4">
                     <div class="form-group">
                        Fecha Alta:
                        <div class="input-group">
                           <span class="input-group-addon">
                              <span class="glyphicon glyphicon-calendar"></span>
                           </span>
                           <input class="form-control datepicker input-sm" type="text" name="f_alta" value="{$fsc->agente->f_alta}" autocomplete="off"/>
                        </div>
                     </div>
                  </div>
                  <div class="col-sm-4">
                     <div class="form-group">
                        Fecha Baja:
                        <div class="input-group">
                           <span class="input-group-addon">
                              <span class="glyphicon glyphicon-calendar"></span>
                           </span>
                           <input class="form-control datepicker input-sm" type="text" name="f_baja" value="{$fsc->agente->f_baja}" autocomplete="off"/>
                        </div>
                     </div>
                  </div>
                  <div class="col-sm-3">
                     <div class="form-group">
                        Seguridad Social:
                        <select name="codseguridadsocial" required class="form-control input-sm">
                            <option value="">--------</option>
                            {loop="$fsc->seguridadsocial->all()"}
                            <option value="{$value->codseguridadsocial}" {if="$fsc->agente->codseguridadsocial==$value->codseguridadsocial"}selected{/if}>{$value->nombre}</option>
                            {/loop}
                        </select>
                     </div>
                  </div>
                  <div class="col-sm-3">
                     <div class="form-group">
                        Nº Seguridad Social:
                        <input class="form-control input-sm" type="text" name="seg_social" value="{$fsc->agente->seg_social}" autocomplete="off"/>
                     </div>
                  </div>
                  <div class="col-sm-3">
                     <div class="form-group">
                        Banco:
                        <select name="codbanco" required class="form-control input-sm">
                            <option value="">--------</option>
                            {loop="$fsc->bancos->all_activos()"}
                            <option value="{$value->codbanco}" {if="$fsc->agente->codbanco==$value->codbanco"}selected{/if}>{$value->nombre}</option>
                            {/loop}
                        </select>
                     </div>
                  </div>
                  <div class="col-sm-3">
                     <div class="form-group">
                        Cuenta Bancaria:
                        <input class="form-control input-sm" type="text" name="cuenta_banco" value="{$fsc->agente->cuenta_banco}" autocomplete="off"/>
                     </div>
                  </div>
                  <div class="col-sm-2">
                     <div class="form-group">
                        Dependientes:
                        <div class="input-group">
                            <span class="input-group-addon input-sm"><span class="fa fa-group"></span></span>
                           <input class="form-control input-sm" type="number" name="dependientes" value="{$fsc->agente->dependientes}" autocomplete="off"/>
                        </div>
                     </div>
                  </div>
                  <div class="col-sm-2">
                     <div class="form-group">
                        Comisión:
                        <div class="input-group">
                           <span class="input-group-addon input-sm">%</span>
                           <input class="form-control input-sm" type="text" name="porcomision" value="{$fsc->agente->porcomision}" autocomplete="off"/>
                        </div>
                     </div>
                  </div>
                  <div class="col-sm-2">
                     <div class="form-group">
                        Tiempo de Contrato:
                        <div class="input-group">
                           <span class="input-group-addon input-sm"><span class="fa fa-calendar"></span></span>
                           <input class="form-control input-sm" type="text" name="porcomision" value="{$fsc->agente->porcomision}" autocomplete="off"/>
                        </div>
                        <span class="help-block">Puede ingresar los meses del contrato actual, pero utilice <b>Contratos</b> para renovar o cerrar un contrato de este Empleado.</span>
                     </div>
                  </div>
                  <div class="col-sm-3">
                     <div class="form-group">
                        Estado:
                        <select name="estado" required class="form-control input-sm">
                            <option value="">--------</option>
                            {loop="$fsc->agente->estados_agente()"}
                            <option value="{$key}" {if="$fsc->agente->estado==$key"}selected{/if}>{$value}</option>
                            {/loop}
                        </select>
                     </div>
                  </div>
                  <div class="col-sm-3">
                     <div class="form-group">
                        Sindicalizado:
                        <select name="idsindicalizado" required class="form-control input-sm">
                            <option value="">--------</option>
                            {loop="$fsc->sindicalizacion->all()"}
                            <option value="{$value->idsindicato}" {if="$fsc->agente->idsindicato==$value->idsindicato"}selected{/if}>{$value->descripcion}</option>
                            {/loop}
                        </select>
                     </div>
                  </div>
               </div>
               <div class="panel-footer" style="text-align: right;">
                  <button class="btn btn-sm btn-primary" type="submit" onclick="this.disabled = true; this.form.submit();">
                     <span class="glyphicon glyphicon-floppy-disk"></span> &nbsp; Guardar
                  </button>
               </div>
            </div>
         </form>
      </div>
   </div>
</div>
{else}
<div class="thumbnail">
   <img src="view/img/fuuu_face.png" alt="fuuuuu"/>
</div>
{/if}

{include="footer"}